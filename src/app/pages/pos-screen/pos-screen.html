<div [class]="(productSetting.darkMode() ? 'bg-gray-950 text-gray-200':'bg-white text-gray-800') + ' fixed top-0 right-0 flex w-full h-screen z-10 text-black'">
  <!-- Left Side-->
  <div class="w-[55%] p-2">
    <!-- upper -->
    <div [class]="(productSetting.darkMode()?'border-gray-700':'border-gray-300')+' scrollCs h-[85%] border  overflow-auto'">
      <p-table [value]="addCartProducts" size="small" selectionMode="single" showGridlines (onRowSelect)="getQty($event)" [(selection)]="selectedRow" dataKey="id">
        <ng-template #header>
          <tr>
            <th>Item</th>
            <th>Before D</th>
            <th>Qty</th>
            <th>Unit</th>
            <th>Discount</th>
            <th>Total Price</th>
            <th>Act</th>
          </tr>
        </ng-template>
        <ng-template #body let-item>
          <tr class="text-center text-[.8rem] border border-gray-300" [pSelectableRow]="item">
            <td class="flex gap-3 px-1 items-center">
              <div>
                <img src="assets/logo.png" width="30" alt="" />
              </div>
              <div class="whitespace-nowrap overflow-auto scrollCs">
                <p class="font-semibold">{{ item.itemCode }} | {{ item.productName }}</p>
                <span
                  >Unit Price: {{ item.price| currency}} | Discount {{ item.discount }}</span
                >
              </div>
            </td>
            <td>{{ item.price | currency}}</td>
            <td>{{ item.qty }}</td>
            <td>{{ item?.uOm?.code}}</td>
            <td class="text-center">
              <p-button
                variant="text"
                severity="info"
                styleClass="p-0"
                size="small"
                [label]="'% ' + item.discount"
                (onClick)="showCouponToggleForTable($event,item.id)"
              />
            </td>
            @if (item.totalPrice) {
              <td>{{item.totalPrice | currency}}</td>
            } @else {
              <td>{{item.qty * item.price | currency}}</td>   
            }
            <td>
              <p-button
              (onClick)="deleteProduct(item.id)"
              icon="pi pi-trash"
              variant="text"
              severity="danger"
              styleClass="p-0"
              size="small"
              />
            </td>
          </tr>
        </ng-template>
        <app-coupon-select [coupons]="coupons" (couponSelected)="couponSelectForTable($event)"  #tableCoupon/>
      </p-table>
    </div>
    <!-- lower -->
    <div [class]="(productSetting.darkMode()?'bg-teal-950/40':'')+' h-[15%]  p-1 flex justify-between'">
      <div class="text-[.9rem] font-semibold whitespace-nowrap">
        <p class="flex justify-between gap-2"><span>Sub Total : </span><span>{{addCartSum.subTotal|currency}}</span></p>
        <p class="flex justify-between gap-2">
          <p-button
          (onClick)="showCoupon($event)"
          size="small"
          styleClass="p-0"
          variant="text"
          severity="info"
          [label]="'% Discount'"
          /><span class="text-green-700">{{ selectCouponVal / 100 | percent }}</span>
          <app-coupon-select [coupons]="coupons" (couponSelected)="couponSelect($event)" #coupon />
        </p>
      </div>
      <div class="text-[1rem] font-bold text-blue-600 whitespace-nowrap">
        <p-button
          (onClick)="toggleCustomer($event)"
          size="small"
          styleClass="p-0 px-1"
          variant="text"
          severity="info"
          icon="pi pi-users"
          [label]="'Customer Name : '"
          /><span class="text-gray-700 text-[.8rem]">{{selectedCustomer?.name }}</span>
          <p-popover styleClass="w-full max-w-90" #customer>
            <div class="p-2">
              <div class="mb-2">
                <span class="font-medium block mb-2">Customers</span>
                <input
                  placeholder="Search Coupons"
                  (input)="searchCustomer($event)"
                  class="w-full"
                  pSize="small"
                  pInputText
                />
              </div>
              <ul class="w-full max-h-50 overflow-auto grid grid-cols-3 gap-2">
                @for (item of filteredCustomer; track $index) {
                <li
                  (click)="selectCustomer(item)"
                  class="h-6 flex flex-col gap-1 col-span-1 bg-blue-100/10 p-1 rounded-md text-[.8rem] cursor-pointer"
                >
                  <p class="bg-blue-800 text-gray-200 rounded-2xl px-2 text-[.7rem]">
                    {{item?.name}}
                  </p>
                </li>
                }
              </ul>
            </div>
          </p-popover>
        <p><span class="font-semibold">Item : </span> <span>{{addCartSum.items}}</span></p>
        <p><span>Net Amount : </span> <span class="text-green-600">{{addCartSum.netAmount|currency}}</span></p>
      </div>
    </div>
  </div>

  <!-- Right Side-->
  <div class="w-[45%]">
    <!-- upper -->
    <div [class]="(productSetting.darkMode()?'bg-blue-950/40':'bg-lime-100')+' h-[65%] flex items-end  p-2'">
      <p-autocomplete
        placeholder="Search ItemCode"
        fluid
        styleClass="w-full"
        [(ngModel)]="selectedProductsAdvanced"
        (onKeyUp)="onKeyUp($event)"
        [suggestions]="filteredProducts"
        (completeMethod)="filterproducts($event)"
        optionLabel="itemCode"
      >
        <ng-template class="border-b!" style="border-bottom: 2px solid" let-product #item>
          <div class="w-full flex items-center justify-between gap-2 text-[.8rem] text-gray-700">
            <div class="flex items-center gap-3">
              <div><img src="assets/logo.png" width="30" alt="image" /></div>
              <div>
                <p class="font-bold">{{ product.productName }}</p>
                <p>{{ product.category }}</p>
              </div>
            </div>
            <p class="underline">#{{ product.itemCode }}</p>
            <div>
              <p class="flex items-center gap-2">
                <span class="pi pi-indian-rupee text-[.7rem]"></span>
                <span class="text-green-500">{{ product.price }}</span>
              </p>
            </div>
          </div>
        </ng-template>
        <ng-template #header>
          <div class="font-medium px-3 py-2">Available Products</div>
        </ng-template>
      </p-autocomplete>
    </div>
    <!-- Lower -->
    <div class="h-[35%] grid grid-cols-8">
      <div [class]="(productSetting.darkMode() ? 'bg-gray-900':'bg-cyan-50 ') + ' flex flex-col col-span-3 p-1'">
        <p class="font-semibold text-[.9rem] text-amber-700">Set Quantity :</p>
        <input [(ngModel)]="selectQty" type="text" readonly pInputText pSize="small" />
        <div class="h-full p-1 grid grid-cols-4 gap-1 grid-rows-4">
          @for (item of calculateNum; track $index) {
          <div [class]="item.class">
            <p-button
              variant="outlined"
              severity="primary"
              [styleClass]="'w-full h-full'"
              size="small"
              (onClick)="setQty(item.id)"
              [label]="item.id.toString()"
            />
          </div>
          }
        </div>
      </div>
      <div class="col-span-5 grid grid-cols-4 grid-rows-4 gap-1 p-1 overflow-auto scrollCs">
        @for (item of posButtons; track $index) {
        <button (click)="getPosButton(item.name)" [class]="getButtonClasses(item)">{{ item.label }}</button>
        }
      </div>
    </div>
  </div>
  <div>
    <p-dialog [visible]="true" modal="true">
    
    </p-dialog>
  </div>
</div>
