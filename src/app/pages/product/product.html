<div class="">
  <p-toast />
  <div class="p-2 py-5 w-full flex justify-end">
    <p-button
      (onClick)="[(isPopupOpen = true), this.productForm.reset()]"
      label="Product"
      size="small"
      variant="outlined"
      icon="pi pi-plus"
    />
  </div>

  <!-- popup -->
  <p-dialog
    [header]="isUpdate ? 'Update Product' : 'Add Product'"
    [modal]="true"
    closable="false"
    [(visible)]="isPopupOpen"
    [style]="{ width: '30rem' }"
  >
    <form
      [formGroup]="productForm"
      (ngSubmit)="AddProduct(productForm)"
      class="mt-2 flex flex-col gap-3"
    >
      <div class="grid grid-cols-2 gap-7">
        <p-floatlabel class="flex-1" variant="on">
          <input
            class="w-full"
            pSize="small"
            pInputText
            id="on_title"
            formControlName="productName"
            autocomplete="off"
          />
          <label for="on_title">Product Name</label>
        </p-floatlabel>
        <p-floatlabel class="flex-1" variant="on">
          <p-inputnumber
            class="w-full"
            size="small"
            type="number"
            id="on_title"
            formControlName="price"
            autocomplete="off"
          />
          <label for="on_title">Price</label>
        </p-floatlabel>
        <p-floatlabel variant="on">
          <p-select
            appendTo="body"
            styleClass="w-full!"
            fluid
            [options]="selectCategory"
            id="on_priority"
            formControlName="category"
            size="small"
            class="w-full md:w-56"
          />
          <label for="on_priority">Category</label>
        </p-floatlabel>
        <p-floatlabel variant="on">
          <p-datepicker
            appendTo="body"
            fluid
            size="small"
            showClear
            inputId="on_deadline"
            formControlName="date"
            showIcon
            iconDisplay="input"
          />
          <label for="on_deadline">Date</label>
        </p-floatlabel>
      </div>
      <div class="mt-4 flex gap-2 justify-between">
        <div class="flex gap-2">
          <p-button
            (onClick)="this.productForm.reset()"
            [disabled]="isUpdate"
            variant="outlined"
            severity="warn"
            label="Reset"
            icon="pi pi-undo"
            size="small"
          />
          <p-button
            type="submit"
            variant="outlined"
            severity="primary"
            [label]="isUpdate ? 'Update' : 'Add'"
            [icon]="isUpdate ? 'pi pi-save' : 'pi pi-plus'"
            size="small"
          />
        </div>
        <div>
          <p-button
            (onClick)="this.formClose()"
            variant="outlined"
            severity="danger"
            label="Close"
            size="small"
          />
        </div>
      </div>
    </form>
  </p-dialog>
</div>

<table
  [class.bg-gray-900]="this.productSetting.darkMode()"
  class="w-[98%] mx-auto rounded-lg overflow-hidden"
>
  <thead
    [class.bg-gray-800]="this.productSetting.darkMode()"
    [class.text-gray-300]="this.productSetting.darkMode()"
    class="bg-gray-100"
  >
    <tr>
      <th class="px-4 py-2 text-left text-md font-semibold">Product Name</th>
      <th class="px-4 py-2 text-left text-md font-semibold">Price</th>
      <th class="px-4 py-2 text-left text-md font-semibold">Date</th>
      <th class="px-4 py-2 text-left text-md font-semibold">Category</th>
      <th class="px-4 py-2 text-left text-md font-semibold">Action</th>
    </tr>
  </thead>

  <tbody>
    @for (p of products; track p; let i = $index) {
    <tr
      [class.hover:bg-gray-800]="this.productSetting.darkMode()"
      [class.border-y-gray-700]="this.productSetting.darkMode()"
      class="hover:bg-gray-50 border-y border-gray-300"
    >
      <td class="px-4 py-1 text-[.8rem]">{{ p.productName }}</td>
      <td class="px-4 py-1 text-[.8rem]">{{ p.price }}</td>
      <td class="px-4 py-1 text-[.8rem]">{{ p.date | date : 'dd-MM-yyyy' }}</td>
      <td class="px-4 py-1 text-[.8rem]">{{ p.category }}</td>
      <td class="px-4 py-1 text-[.8rem] flex gap-2">
        <p-button
          (onClick)="editProduct(p, p.id)"
          severity="help"
          [variant]="this.productSetting.darkMode() ? 'text' : 'outlined'"
          icon="pi pi-pencil"
          size="small"
          styleClass="p-1"
        />
        <p-button
          (onClick)="deleteProduct(p.id)"
          severity="danger"
          [variant]="this.productSetting.darkMode() ? 'text' : 'outlined'"
          icon="pi pi-trash"
          size="small"
          styleClass="p-1"
        />
      </td>
    </tr>
    }
  </tbody>
</table>
